\hypertarget{distortion_8c_source}{}\doxysection{distortion.\+c}
\label{distortion_8c_source}\index{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Src/distortion.c@{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Src/distortion.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{distortion_8h}{distortion.h}}"{}}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00002}00002 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{atanLUT_8h}{atanLUT.h}}"{}}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00003}00003 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00010}\mbox{\hyperlink{distortion_8h_a54ad82c4a3ecbc0c2784ae81c92eb22e}{00010}} Distortion\_Status \mbox{\hyperlink{distortion_8h_a54ad82c4a3ecbc0c2784ae81c92eb22e}{Distortion\_Init}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00012}00012     \mbox{\hyperlink{distortion_8h_a2a6725ec967773f5ddfbc3fc21d67049}{SetupHardClippingDistortion}}(\&HardClipping);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00013}00013     \mbox{\hyperlink{distortion_8h_a8a375c625074dc4492066cda7e9e175b}{SetupSoftClippingDistortion}}(\&SoftClipping);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00015}00015     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00016}00016 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00023}\mbox{\hyperlink{distortion_8h_ac69b82a1179f795d9205a246de59a37a}{00023}} Distortion\_Status \mbox{\hyperlink{distortion_8h_ac69b82a1179f795d9205a246de59a37a}{Distortion\_Reset}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00025}00025     Display.Distortion\_ONOFF = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00027}00027     Display.Distortion\_Gain = SoftClipping.distortion\_gain = 1.0;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00029}00029     Display.Distortion\_Sources = POTI;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00031}00031     Display.Distortion\_Type = 0;    \textcolor{comment}{// Soft Clipping}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00033}00033     strcpy(Display.value\_str\_distortion[1], \textcolor{stringliteral}{"{}Soft"{}});}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00035}00035     strcpy(Display.value\_str\_distortion[0], \textcolor{stringliteral}{"{}OFF"{}});}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00037}00037     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00038}00038 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00045}\mbox{\hyperlink{distortion_8h_a2a6725ec967773f5ddfbc3fc21d67049}{00045}} Distortion\_Status \mbox{\hyperlink{distortion_8h_a2a6725ec967773f5ddfbc3fc21d67049}{SetupHardClippingDistortion}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structeffects__distortion}{effects\_distortion}}* HardClipping) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00047}00047     HardClipping-\/>distortion\_gain = 1.0;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00048}00048     HardClipping-\/>distortion\_maximum\_gain = 9;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00049}00049 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00050}00050     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00051}00051 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00059}\mbox{\hyperlink{distortion_8h_a8a375c625074dc4492066cda7e9e175b}{00059}} Distortion\_Status \mbox{\hyperlink{distortion_8h_a8a375c625074dc4492066cda7e9e175b}{SetupSoftClippingDistortion}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structeffects__distortion}{effects\_distortion}}* SoftClipping) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00061}00061     SoftClipping-\/>distortion\_gain = 1.0;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00063}00063     \textcolor{comment}{// 10 different distortion gain values, so the effect can be increased step-\/wise}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00064}00064     SoftClipping-\/>atan\_softclipping\_distortion\_max[0] = 0.392650;   \textcolor{comment}{// distortion\_gain = 1.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00065}00065     SoftClipping-\/>atan\_softclipping\_distortion\_max[1] = 0.553650;   \textcolor{comment}{// distortion\_gain = 2.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00066}00066     SoftClipping-\/>atan\_softclipping\_distortion\_max[2] = 0.624500;   \textcolor{comment}{// distortion\_gain = 3.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00067}00067     SoftClipping-\/>atan\_softclipping\_distortion\_max[3] = 0.662950;   \textcolor{comment}{// distortion\_gain = 4.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00068}00068     SoftClipping-\/>atan\_softclipping\_distortion\_max[4] = 0.686700;   \textcolor{comment}{// distortion\_gain = 5.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00069}00069     SoftClipping-\/>atan\_softclipping\_distortion\_max[5] = 0.702850;   \textcolor{comment}{// distortion\_gain = 6.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00070}00070     SoftClipping-\/>atan\_softclipping\_distortion\_max[6] = 0.714450;   \textcolor{comment}{// distortion\_gain = 7.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00071}00071     SoftClipping-\/>atan\_softclipping\_distortion\_max[7] = 0.723200;   \textcolor{comment}{// distortion\_gain = 8.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00072}00072     SoftClipping-\/>atan\_softclipping\_distortion\_max[8] = 0.730050;   \textcolor{comment}{// distortion\_gain = 9.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00073}00073     SoftClipping-\/>atan\_softclipping\_distortion\_max[9] = 0.735550;   \textcolor{comment}{// distortion\_gain = 10.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00075}00075     SoftClipping-\/>distortion\_maximum\_gain = 10.0;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00076}00076 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00077}00077     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00078}00078 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00086}\mbox{\hyperlink{distortion_8h_a7a68b2a90c4306d739161ee82b7eb89c}{00086}} Distortion\_Status \mbox{\hyperlink{distortion_8h_a7a68b2a90c4306d739161ee82b7eb89c}{ProcessHardClippingDistortion}}(\textcolor{keywordtype}{float}* data) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00088}00088     \textcolor{keywordtype}{float} calc = *data;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00090}00090     \textcolor{keywordflow}{if}( HardClipping.distortion\_gain * calc <= -\/1 ) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00091}00091         calc = -\/1;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00092}00092     \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00093}00093     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( (HardClipping.distortion\_gain * calc > -\/1) \&\& (HardClipping.distortion\_gain * calc < 1) ) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00094}00094         calc = HardClipping.distortion\_gain * calc;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00095}00095     \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00096}00096     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( HardClipping.distortion\_gain * calc >= 1 ) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00097}00097         calc = 1;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00098}00098     \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00100}00100     *data = calc;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00101}00101 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00102}00102     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00103}00103 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00104}00104 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00111}\mbox{\hyperlink{distortion_8h_a1676e7551d7621b89efb0ecc46092436}{00111}} Distortion\_Status \mbox{\hyperlink{distortion_8h_a1676e7551d7621b89efb0ecc46092436}{ProcessSoftClippingDistortion}}(\textcolor{keywordtype}{float}* data) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00112}00112 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00113}00113     \textcolor{keywordtype}{float} calc = *data;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00114}00114 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00115}00115 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00116}00116     \textcolor{comment}{// Sinnvoller Gain: 1 -\/ 10}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00117}00117     \textcolor{comment}{// Use known Arcustangens values, which have been estimated (LUT-\/style)}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00119}00119     SoftClipping.atan\_parameter = (SoftClipping.distortion\_gain * calc) + 10;   \textcolor{comment}{// SoftClipping.distortion\_maximum\_gain = 10}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00120}00120     SoftClipping.distortion\_index = round(SoftClipping.atan\_parameter/aquidistance);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00121}00121     calc = 0.5*\mbox{\hyperlink{atanLUT_8h_a44717ae85351202c8833c3880a6ef9e8}{atan\_LUT\_y}}[SoftClipping.distortion\_index]; \textcolor{comment}{// scale down the amplitude}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00122}00122 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00123}00123     \textcolor{keywordflow}{if}(0.0 <= SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 1.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00124}00124         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[0]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00126}00126     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(1.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 2.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00127}00127         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[1]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00128}00128 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00129}00129     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(2.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 3.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00130}00130         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[2]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00131}00131 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00132}00132     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(3.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 4.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00133}00133         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[3]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00134}00134 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00135}00135     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(4.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 5.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00136}00136         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[4]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00137}00137 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00138}00138     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(5.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 6.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00139}00139         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[5]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00140}00140 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00141}00141     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(6.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 7.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00142}00142         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[6]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00143}00143 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00144}00144     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(7.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 8.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00145}00145         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[7]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00146}00146 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00147}00147     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(8.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 9.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00148}00148         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[8]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00149}00149 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00150}00150     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(SoftClipping.distortion\_gain > 9.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00151}00151         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[9]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00152}00152 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00153}00153     *data = calc;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00154}00154 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00155}00155     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00156}00156 \}}

\end{DoxyCode}
