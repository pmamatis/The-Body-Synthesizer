\hypertarget{distortion_8c_source}{}\doxysection{distortion.\+c}
\label{distortion_8c_source}\index{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Src/distortion.c@{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Src/distortion.c}}
\mbox{\hyperlink{distortion_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00011}00011 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{distortion_8h}{distortion.h}}"{}}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00012}00012 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{atanLUT_8h}{atanLUT.h}}"{}}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00020}\mbox{\hyperlink{group__Distortion_ga54ad82c4a3ecbc0c2784ae81c92eb22e}{00020}} Distortion\_Status \mbox{\hyperlink{group__Distortion_ga54ad82c4a3ecbc0c2784ae81c92eb22e}{Distortion\_Init}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00021}00021 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00022}00022     \mbox{\hyperlink{group__Distortion_ga2a6725ec967773f5ddfbc3fc21d67049}{SetupHardClippingDistortion}}(\&HardClipping);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00023}00023     \mbox{\hyperlink{group__Distortion_ga8a375c625074dc4492066cda7e9e175b}{SetupSoftClippingDistortion}}(\&SoftClipping);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00025}00025     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00026}00026 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00033}\mbox{\hyperlink{group__Distortion_gac69b82a1179f795d9205a246de59a37a}{00033}} Distortion\_Status \mbox{\hyperlink{group__Distortion_gac69b82a1179f795d9205a246de59a37a}{Distortion\_Reset}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00035}00035     Display.Distortion\_ONOFF = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00037}00037     Display.Distortion\_Gain = SoftClipping.distortion\_gain = 1.0;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00039}00039     Display.Distortion\_Sources = POTI;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00041}00041     Display.Distortion\_Type = 0;    \textcolor{comment}{// Soft Clipping}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00042}00042 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00043}00043     strcpy(Display.value\_str\_distortion[1], \textcolor{stringliteral}{"{}Soft"{}});}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00045}00045     strcpy(Display.value\_str\_distortion[0], \textcolor{stringliteral}{"{}OFF"{}});}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00047}00047     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00048}00048 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00055}\mbox{\hyperlink{group__Distortion_ga2a6725ec967773f5ddfbc3fc21d67049}{00055}} Distortion\_Status \mbox{\hyperlink{group__Distortion_ga2a6725ec967773f5ddfbc3fc21d67049}{SetupHardClippingDistortion}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structeffects__distortion}{effects\_distortion}}* HardClipping) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00057}00057     HardClipping-\/>distortion\_gain = 1.0;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00058}00058     HardClipping-\/>distortion\_maximum\_gain = 9;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00059}00059 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00060}00060     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00061}00061 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00069}\mbox{\hyperlink{group__Distortion_ga8a375c625074dc4492066cda7e9e175b}{00069}} Distortion\_Status \mbox{\hyperlink{group__Distortion_ga8a375c625074dc4492066cda7e9e175b}{SetupSoftClippingDistortion}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structeffects__distortion}{effects\_distortion}}* SoftClipping) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00071}00071     SoftClipping-\/>distortion\_gain = 1.0;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00072}00072 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00073}00073     \textcolor{comment}{// 10 different distortion gain values, so the effect can be increased step-\/wise}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00074}00074     SoftClipping-\/>atan\_softclipping\_distortion\_max[0] = 0.392650;   \textcolor{comment}{// distortion\_gain = 1.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00075}00075     SoftClipping-\/>atan\_softclipping\_distortion\_max[1] = 0.553650;   \textcolor{comment}{// distortion\_gain = 2.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00076}00076     SoftClipping-\/>atan\_softclipping\_distortion\_max[2] = 0.624500;   \textcolor{comment}{// distortion\_gain = 3.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00077}00077     SoftClipping-\/>atan\_softclipping\_distortion\_max[3] = 0.662950;   \textcolor{comment}{// distortion\_gain = 4.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00078}00078     SoftClipping-\/>atan\_softclipping\_distortion\_max[4] = 0.686700;   \textcolor{comment}{// distortion\_gain = 5.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00079}00079     SoftClipping-\/>atan\_softclipping\_distortion\_max[5] = 0.702850;   \textcolor{comment}{// distortion\_gain = 6.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00080}00080     SoftClipping-\/>atan\_softclipping\_distortion\_max[6] = 0.714450;   \textcolor{comment}{// distortion\_gain = 7.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00081}00081     SoftClipping-\/>atan\_softclipping\_distortion\_max[7] = 0.723200;   \textcolor{comment}{// distortion\_gain = 8.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00082}00082     SoftClipping-\/>atan\_softclipping\_distortion\_max[8] = 0.730050;   \textcolor{comment}{// distortion\_gain = 9.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00083}00083     SoftClipping-\/>atan\_softclipping\_distortion\_max[9] = 0.735550;   \textcolor{comment}{// distortion\_gain = 10.0}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00085}00085     SoftClipping-\/>distortion\_maximum\_gain = 10.0;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00086}00086 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00087}00087     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00088}00088 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00096}\mbox{\hyperlink{group__Distortion_ga7a68b2a90c4306d739161ee82b7eb89c}{00096}} Distortion\_Status \mbox{\hyperlink{group__Distortion_ga7a68b2a90c4306d739161ee82b7eb89c}{ProcessHardClippingDistortion}}(\textcolor{keywordtype}{float}* data) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00097}00097 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00098}00098     \textcolor{keywordtype}{float} calc = *data;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00100}00100     \textcolor{keywordflow}{if}( HardClipping.distortion\_gain * calc <= -\/1 ) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00101}00101         calc = -\/1;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00102}00102     \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00103}00103     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( (HardClipping.distortion\_gain * calc > -\/1) \&\& (HardClipping.distortion\_gain * calc < 1) ) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00104}00104         calc = HardClipping.distortion\_gain * calc;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00105}00105     \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00106}00106     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( HardClipping.distortion\_gain * calc >= 1 ) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00107}00107         calc = 1;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00108}00108     \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00109}00109 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00110}00110     *data = calc;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00112}00112     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00113}00113 \}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00114}00114 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00121}\mbox{\hyperlink{group__Distortion_ga1676e7551d7621b89efb0ecc46092436}{00121}} Distortion\_Status \mbox{\hyperlink{group__Distortion_ga1676e7551d7621b89efb0ecc46092436}{ProcessSoftClippingDistortion}}(\textcolor{keywordtype}{float}* data) \{}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00122}00122 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00123}00123     \textcolor{keywordtype}{float} calc = *data;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00124}00124 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00126}00126     \textcolor{comment}{// Sinnvoller Gain: 1 -\/ 10}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00127}00127     \textcolor{comment}{// Use known Arcustangens values, which have been estimated (LUT-\/style)}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00128}00128 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00129}00129     SoftClipping.atan\_parameter = (SoftClipping.distortion\_gain * calc) + 10;   \textcolor{comment}{// SoftClipping.distortion\_maximum\_gain = 10}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00130}00130     SoftClipping.distortion\_index = round(SoftClipping.atan\_parameter/\mbox{\hyperlink{group__atanLUT_ga5b267ef41aab26158640ba93071f0b97}{aquidistance}});}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00131}00131     calc = 0.5*\mbox{\hyperlink{group__atanLUT_ga44717ae85351202c8833c3880a6ef9e8}{atan\_LUT\_y}}[SoftClipping.distortion\_index];}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00132}00132 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00133}00133     \textcolor{comment}{// scale down the amplitude}}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00134}00134     \textcolor{keywordflow}{if}(0.0 <= SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 1.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00135}00135         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[0]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00136}00136 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00137}00137     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(1.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 2.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00138}00138         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[1]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00139}00139 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00140}00140     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(2.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 3.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00141}00141         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[2]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00142}00142 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00143}00143     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(3.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 4.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00144}00144         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[3]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00146}00146     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(4.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 5.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00147}00147         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[4]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00149}00149     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(5.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 6.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00150}00150         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[5]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00151}00151 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00152}00152     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(6.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 7.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00153}00153         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[6]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00154}00154 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00155}00155     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(7.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 8.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00156}00156         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[7]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00158}00158     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(8.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 9.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00159}00159         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[8]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00160}00160 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00161}00161     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(SoftClipping.distortion\_gain > 9.0)}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00162}00162         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[9]);}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00163}00163 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00164}00164     *data = calc;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00166}00166     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{\Hypertarget{distortion_8c_source_l00167}00167 \}}

\end{DoxyCode}
