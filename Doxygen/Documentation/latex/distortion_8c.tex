\hypertarget{distortion_8c}{}\doxysection{/media/paul/\+LINUX\+\_\+\+MEM/\+Uni/\+Git Repos/\+Body-\/\+Synthesizer\+\_\+\+STM32\+\_\+\+F746\+ZG/body-\/synthesizer-\/stm32-\/f746zg/\+Core/\+Src/distortion.c File Reference}
\label{distortion_8c}\index{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Src/distortion.c@{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Src/distortion.c}}


Distortion effect.  


{\ttfamily \#include \char`\"{}distortion.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}atan\+LUT.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
Distortion\+\_\+\+Status \mbox{\hyperlink{distortion_8c_a54ad82c4a3ecbc0c2784ae81c92eb22e}{Distortion\+\_\+\+Init}} (void)
\begin{DoxyCompactList}\small\item\em Distortion init functions. \end{DoxyCompactList}\item 
Distortion\+\_\+\+Status \mbox{\hyperlink{distortion_8c_ac69b82a1179f795d9205a246de59a37a}{Distortion\+\_\+\+Reset}} (void)
\item 
Distortion\+\_\+\+Status \mbox{\hyperlink{distortion_8c_a2a6725ec967773f5ddfbc3fc21d67049}{Setup\+Hard\+Clipping\+Distortion}} (struct \mbox{\hyperlink{structeffects__distortion}{effects\+\_\+distortion}} $\ast$Hard\+Clipping)
\item 
Distortion\+\_\+\+Status \mbox{\hyperlink{distortion_8c_a8a375c625074dc4492066cda7e9e175b}{Setup\+Soft\+Clipping\+Distortion}} (struct \mbox{\hyperlink{structeffects__distortion}{effects\+\_\+distortion}} $\ast$Soft\+Clipping)
\item 
Distortion\+\_\+\+Status \mbox{\hyperlink{distortion_8c_a7a68b2a90c4306d739161ee82b7eb89c}{Process\+Hard\+Clipping\+Distortion}} (float $\ast$data)
\item 
Distortion\+\_\+\+Status \mbox{\hyperlink{distortion_8c_a1676e7551d7621b89efb0ecc46092436}{Process\+Soft\+Clipping\+Distortion}} (float $\ast$data)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Distortion effect. 

\begin{DoxyAuthor}{Author}
Marc Bielen 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2022-\/01-\/21
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2022 
\end{DoxyCopyright}


Definition in file \mbox{\hyperlink{distortion_8c_source}{distortion.\+c}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{distortion_8c_a54ad82c4a3ecbc0c2784ae81c92eb22e}\label{distortion_8c_a54ad82c4a3ecbc0c2784ae81c92eb22e}} 
\index{distortion.c@{distortion.c}!Distortion\_Init@{Distortion\_Init}}
\index{Distortion\_Init@{Distortion\_Init}!distortion.c@{distortion.c}}
\doxysubsubsection{\texorpdfstring{Distortion\_Init()}{Distortion\_Init()}}
{\footnotesize\ttfamily Distortion\+\_\+\+Status Distortion\+\_\+\+Init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Distortion init functions. 


\begin{DoxyParams}{Parameters}
{\em Distortion} & \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{distortion_8c_source_l00020}{20}} of file \mbox{\hyperlink{distortion_8c_source}{distortion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00020                                         \{}
\DoxyCodeLine{00021 }
\DoxyCodeLine{00022     \mbox{\hyperlink{distortion_8c_a2a6725ec967773f5ddfbc3fc21d67049}{SetupHardClippingDistortion}}(\&HardClipping);}
\DoxyCodeLine{00023     \mbox{\hyperlink{distortion_8c_a8a375c625074dc4492066cda7e9e175b}{SetupSoftClippingDistortion}}(\&SoftClipping);}
\DoxyCodeLine{00024 }
\DoxyCodeLine{00025     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{00026 \}}

\end{DoxyCode}
\mbox{\Hypertarget{distortion_8c_ac69b82a1179f795d9205a246de59a37a}\label{distortion_8c_ac69b82a1179f795d9205a246de59a37a}} 
\index{distortion.c@{distortion.c}!Distortion\_Reset@{Distortion\_Reset}}
\index{Distortion\_Reset@{Distortion\_Reset}!distortion.c@{distortion.c}}
\doxysubsubsection{\texorpdfstring{Distortion\_Reset()}{Distortion\_Reset()}}
{\footnotesize\ttfamily Distortion\+\_\+\+Status Distortion\+\_\+\+Reset (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

TODO \begin{DoxyReturn}{Returns}
Distortion\+\_\+\+Status 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{distortion_8c_source_l00033}{33}} of file \mbox{\hyperlink{distortion_8c_source}{distortion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00033                                          \{}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00035     Display.Distortion\_ONOFF = \textcolor{keyword}{false};}
\DoxyCodeLine{00036 }
\DoxyCodeLine{00037     Display.Distortion\_Gain = SoftClipping.distortion\_gain = 1.0;}
\DoxyCodeLine{00038 }
\DoxyCodeLine{00039     Display.Distortion\_Sources = POTI;}
\DoxyCodeLine{00040 }
\DoxyCodeLine{00041     Display.Distortion\_Type = 0;    \textcolor{comment}{// Soft Clipping}}
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043     strcpy(Display.value\_str\_distortion[1], \textcolor{stringliteral}{"{}Soft"{}});}
\DoxyCodeLine{00044 }
\DoxyCodeLine{00045     strcpy(Display.value\_str\_distortion[0], \textcolor{stringliteral}{"{}OFF"{}});}
\DoxyCodeLine{00046 }
\DoxyCodeLine{00047     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{00048 \}}

\end{DoxyCode}
\mbox{\Hypertarget{distortion_8c_a7a68b2a90c4306d739161ee82b7eb89c}\label{distortion_8c_a7a68b2a90c4306d739161ee82b7eb89c}} 
\index{distortion.c@{distortion.c}!ProcessHardClippingDistortion@{ProcessHardClippingDistortion}}
\index{ProcessHardClippingDistortion@{ProcessHardClippingDistortion}!distortion.c@{distortion.c}}
\doxysubsubsection{\texorpdfstring{ProcessHardClippingDistortion()}{ProcessHardClippingDistortion()}}
{\footnotesize\ttfamily Distortion\+\_\+\+Status Process\+Hard\+Clipping\+Distortion (\begin{DoxyParamCaption}\item[{float $\ast$}]{data }\end{DoxyParamCaption})}


\begin{DoxyParams}{Parameters}
{\em data} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Distortion\+\_\+\+Status 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{distortion_8c_source_l00096}{96}} of file \mbox{\hyperlink{distortion_8c_source}{distortion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00096                                                              \{}
\DoxyCodeLine{00097 }
\DoxyCodeLine{00098     \textcolor{keywordtype}{float} calc = *data;}
\DoxyCodeLine{00099 }
\DoxyCodeLine{00100     \textcolor{keywordflow}{if}( HardClipping.distortion\_gain * calc <= -\/1 ) \{}
\DoxyCodeLine{00101         calc = -\/1;}
\DoxyCodeLine{00102     \}}
\DoxyCodeLine{00103     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( (HardClipping.distortion\_gain * calc > -\/1) \&\& (HardClipping.distortion\_gain * calc < 1) ) \{}
\DoxyCodeLine{00104         calc = HardClipping.distortion\_gain * calc;}
\DoxyCodeLine{00105     \}}
\DoxyCodeLine{00106     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( HardClipping.distortion\_gain * calc >= 1 ) \{}
\DoxyCodeLine{00107         calc = 1;}
\DoxyCodeLine{00108     \}}
\DoxyCodeLine{00109 }
\DoxyCodeLine{00110     *data = calc;}
\DoxyCodeLine{00111 }
\DoxyCodeLine{00112     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{00113 \}}

\end{DoxyCode}
\mbox{\Hypertarget{distortion_8c_a1676e7551d7621b89efb0ecc46092436}\label{distortion_8c_a1676e7551d7621b89efb0ecc46092436}} 
\index{distortion.c@{distortion.c}!ProcessSoftClippingDistortion@{ProcessSoftClippingDistortion}}
\index{ProcessSoftClippingDistortion@{ProcessSoftClippingDistortion}!distortion.c@{distortion.c}}
\doxysubsubsection{\texorpdfstring{ProcessSoftClippingDistortion()}{ProcessSoftClippingDistortion()}}
{\footnotesize\ttfamily Distortion\+\_\+\+Status Process\+Soft\+Clipping\+Distortion (\begin{DoxyParamCaption}\item[{float $\ast$}]{data }\end{DoxyParamCaption})}


\begin{DoxyParams}{Parameters}
{\em data} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Distortion\+\_\+\+Status 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{distortion_8c_source_l00121}{121}} of file \mbox{\hyperlink{distortion_8c_source}{distortion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00121                                                              \{}
\DoxyCodeLine{00122 }
\DoxyCodeLine{00123     \textcolor{keywordtype}{float} calc = *data;}
\DoxyCodeLine{00124 }
\DoxyCodeLine{00125 }
\DoxyCodeLine{00126     \textcolor{comment}{// Sinnvoller Gain: 1 -\/ 10}}
\DoxyCodeLine{00127     \textcolor{comment}{// Use known Arcustangens values, which have been estimated (LUT-\/style)}}
\DoxyCodeLine{00128 }
\DoxyCodeLine{00129     SoftClipping.atan\_parameter = (SoftClipping.distortion\_gain * calc) + 10;   \textcolor{comment}{// SoftClipping.distortion\_maximum\_gain = 10}}
\DoxyCodeLine{00130     SoftClipping.distortion\_index = round(SoftClipping.atan\_parameter/aquidistance);}
\DoxyCodeLine{00131     calc = 0.5*\mbox{\hyperlink{atanLUT_8h_a44717ae85351202c8833c3880a6ef9e8}{atan\_LUT\_y}}[SoftClipping.distortion\_index]; \textcolor{comment}{// scale down the amplitude}}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133     \textcolor{keywordflow}{if}(0.0 <= SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 1.0)}
\DoxyCodeLine{00134         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[0]);}
\DoxyCodeLine{00135 }
\DoxyCodeLine{00136     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(1.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 2.0)}
\DoxyCodeLine{00137         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[1]);}
\DoxyCodeLine{00138 }
\DoxyCodeLine{00139     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(2.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 3.0)}
\DoxyCodeLine{00140         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[2]);}
\DoxyCodeLine{00141 }
\DoxyCodeLine{00142     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(3.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 4.0)}
\DoxyCodeLine{00143         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[3]);}
\DoxyCodeLine{00144 }
\DoxyCodeLine{00145     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(4.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 5.0)}
\DoxyCodeLine{00146         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[4]);}
\DoxyCodeLine{00147 }
\DoxyCodeLine{00148     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(5.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 6.0)}
\DoxyCodeLine{00149         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[5]);}
\DoxyCodeLine{00150 }
\DoxyCodeLine{00151     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(6.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 7.0)}
\DoxyCodeLine{00152         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[6]);}
\DoxyCodeLine{00153 }
\DoxyCodeLine{00154     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(7.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 8.0)}
\DoxyCodeLine{00155         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[7]);}
\DoxyCodeLine{00156 }
\DoxyCodeLine{00157     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(8.0 < SoftClipping.distortion\_gain \&\& SoftClipping.distortion\_gain <= 9.0)}
\DoxyCodeLine{00158         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[8]);}
\DoxyCodeLine{00159 }
\DoxyCodeLine{00160     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(SoftClipping.distortion\_gain > 9.0)}
\DoxyCodeLine{00161         calc = calc * (1.f/SoftClipping.atan\_softclipping\_distortion\_max[9]);}
\DoxyCodeLine{00162 }
\DoxyCodeLine{00163     *data = calc;}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{00166 \}}

\end{DoxyCode}
\mbox{\Hypertarget{distortion_8c_a2a6725ec967773f5ddfbc3fc21d67049}\label{distortion_8c_a2a6725ec967773f5ddfbc3fc21d67049}} 
\index{distortion.c@{distortion.c}!SetupHardClippingDistortion@{SetupHardClippingDistortion}}
\index{SetupHardClippingDistortion@{SetupHardClippingDistortion}!distortion.c@{distortion.c}}
\doxysubsubsection{\texorpdfstring{SetupHardClippingDistortion()}{SetupHardClippingDistortion()}}
{\footnotesize\ttfamily Distortion\+\_\+\+Status Setup\+Hard\+Clipping\+Distortion (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structeffects__distortion}{effects\+\_\+distortion}} $\ast$}]{Hard\+Clipping }\end{DoxyParamCaption})}


\begin{DoxyParams}{Parameters}
{\em Hard\+Clipping} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Distortion\+\_\+\+Status 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{distortion_8c_source_l00055}{55}} of file \mbox{\hyperlink{distortion_8c_source}{distortion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00055                                                                                        \{}
\DoxyCodeLine{00056 }
\DoxyCodeLine{00057     HardClipping-\/>distortion\_gain = 1.0;}
\DoxyCodeLine{00058     HardClipping-\/>distortion\_maximum\_gain = 9;}
\DoxyCodeLine{00059 }
\DoxyCodeLine{00060     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{00061 \}}

\end{DoxyCode}
\mbox{\Hypertarget{distortion_8c_a8a375c625074dc4492066cda7e9e175b}\label{distortion_8c_a8a375c625074dc4492066cda7e9e175b}} 
\index{distortion.c@{distortion.c}!SetupSoftClippingDistortion@{SetupSoftClippingDistortion}}
\index{SetupSoftClippingDistortion@{SetupSoftClippingDistortion}!distortion.c@{distortion.c}}
\doxysubsubsection{\texorpdfstring{SetupSoftClippingDistortion()}{SetupSoftClippingDistortion()}}
{\footnotesize\ttfamily Distortion\+\_\+\+Status Setup\+Soft\+Clipping\+Distortion (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structeffects__distortion}{effects\+\_\+distortion}} $\ast$}]{Soft\+Clipping }\end{DoxyParamCaption})}


\begin{DoxyParams}{Parameters}
{\em Soft\+Clipping} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Distortion\+\_\+\+Status 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{distortion_8c_source_l00069}{69}} of file \mbox{\hyperlink{distortion_8c_source}{distortion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00069                                                                                        \{}
\DoxyCodeLine{00070 }
\DoxyCodeLine{00071     SoftClipping-\/>distortion\_gain = 1.0;}
\DoxyCodeLine{00072 }
\DoxyCodeLine{00073     \textcolor{comment}{// 10 different distortion gain values, so the effect can be increased step-\/wise}}
\DoxyCodeLine{00074     SoftClipping-\/>atan\_softclipping\_distortion\_max[0] = 0.392650;   \textcolor{comment}{// distortion\_gain = 1.0}}
\DoxyCodeLine{00075     SoftClipping-\/>atan\_softclipping\_distortion\_max[1] = 0.553650;   \textcolor{comment}{// distortion\_gain = 2.0}}
\DoxyCodeLine{00076     SoftClipping-\/>atan\_softclipping\_distortion\_max[2] = 0.624500;   \textcolor{comment}{// distortion\_gain = 3.0}}
\DoxyCodeLine{00077     SoftClipping-\/>atan\_softclipping\_distortion\_max[3] = 0.662950;   \textcolor{comment}{// distortion\_gain = 4.0}}
\DoxyCodeLine{00078     SoftClipping-\/>atan\_softclipping\_distortion\_max[4] = 0.686700;   \textcolor{comment}{// distortion\_gain = 5.0}}
\DoxyCodeLine{00079     SoftClipping-\/>atan\_softclipping\_distortion\_max[5] = 0.702850;   \textcolor{comment}{// distortion\_gain = 6.0}}
\DoxyCodeLine{00080     SoftClipping-\/>atan\_softclipping\_distortion\_max[6] = 0.714450;   \textcolor{comment}{// distortion\_gain = 7.0}}
\DoxyCodeLine{00081     SoftClipping-\/>atan\_softclipping\_distortion\_max[7] = 0.723200;   \textcolor{comment}{// distortion\_gain = 8.0}}
\DoxyCodeLine{00082     SoftClipping-\/>atan\_softclipping\_distortion\_max[8] = 0.730050;   \textcolor{comment}{// distortion\_gain = 9.0}}
\DoxyCodeLine{00083     SoftClipping-\/>atan\_softclipping\_distortion\_max[9] = 0.735550;   \textcolor{comment}{// distortion\_gain = 10.0}}
\DoxyCodeLine{00084 }
\DoxyCodeLine{00085     SoftClipping-\/>distortion\_maximum\_gain = 10.0;}
\DoxyCodeLine{00086 }
\DoxyCodeLine{00087     \textcolor{keywordflow}{return} DISTORTION\_OK;}
\DoxyCodeLine{00088 \}}

\end{DoxyCode}
