\hypertarget{wahwah_8c_source}{}\doxysection{wahwah.\+c}
\label{wahwah_8c_source}\index{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Src/wahwah.c@{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Src/wahwah.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{wahwah_8h}{wahwah.h}}"{}}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00003}00003 \textcolor{comment}{/*********************************}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00004}00004 \textcolor{comment}{ * @brief       WahWah functions}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00005}00005 \textcolor{comment}{ * @parameter   WahWah}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00006}00006 \textcolor{comment}{ *********************************/}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00007}00007 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00014}\mbox{\hyperlink{wahwah_8h_afdc2b53d4cc3352bf6e51df974ce169e}{00014}} WahWah\_Status \mbox{\hyperlink{wahwah_8h_afdc2b53d4cc3352bf6e51df974ce169e}{WahWah\_Init}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structWahWah__t}{WahWah\_t}} *WahWah) \{}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00016}00016     WahWah-\/>lfo = \&lfo\_wahwah;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00017}00017     WahWah-\/>bandpass = \&BP\_WAHWAH;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00019}00019     WahWah-\/>lfo-\/>lfo\_index     = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00020}00020     WahWah-\/>lfo-\/>lfo\_quarter   = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00021}00021     WahWah-\/>lfo-\/>lfo\_frequency = 1; \textcolor{comment}{// [0.125, 0.25, 0.5, 1, 2, 4, 8, 16]}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00023}00023     WahWah-\/>range        = 600;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00024}00024     WahWah-\/>mid\_freq     = 350;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00025}00025     WahWah-\/>mid\_freq\_mod = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00027}00027     WahWah-\/>max\_range = 500;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00028}00028     WahWah-\/>max\_mid\_freq = 2000;    \textcolor{comment}{// can be adjusted in the display to values 1000, 2000, 3000 and 4000}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00029}00029     WahWah-\/>max\_Q = 20;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00031}00031     WahWah-\/>reinit\_counter = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00032}00032     WahWah-\/>bandpass-\/>Q = 1;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00034}00034     \mbox{\hyperlink{filters_8h_a30d8b183489ac4208a5fe11ba3a5dd40}{SetupBandpassCPG}}(WahWah-\/>bandpass, WahWah-\/>mid\_freq, WahWah-\/>bandpass-\/>Q);}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00036}00036     \textcolor{keywordflow}{return} WAHWAH\_OK;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00037}00037 \}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00045}\mbox{\hyperlink{wahwah_8h_a9b91a7fae64755689936b60cf1820535}{00045}} WahWah\_Status \mbox{\hyperlink{wahwah_8h_a9b91a7fae64755689936b60cf1820535}{WahWah\_Reset}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structWahWah__t}{WahWah\_t}} *WahWah) \{}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00047}00047     Display.WahWah\_ONOFF = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00049}00049     WahWah-\/>lfo-\/>lfo\_index     = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00050}00050     WahWah-\/>lfo-\/>lfo\_quarter   = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00051}00051     Display.WahWah\_LFOfreq = WahWah-\/>lfo-\/>lfo\_frequency = 1;    \textcolor{comment}{// [0.125, 0.25, 0.5, 1, 2, 4, 8, 16]}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00052}00052     Display.WahWah\_LFOfreq\_Index = Display.last\_WahWah\_LFOfreq\_Index = 3;   \textcolor{comment}{// 1 Hz}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00054}00054     Display.WahWah\_Range = WahWah-\/>range        = 600;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00055}00055     Display.WahWah\_MidFreq = WahWah-\/>mid\_freq     = 350;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00056}00056     WahWah-\/>mid\_freq\_mod = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00058}00058     WahWah-\/>reinit\_counter = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00059}00059     Display.WahWah\_Q = WahWah-\/>bandpass-\/>Q = 1;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00061}00061     Display.WahWah\_Sources[0] = POTI;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00062}00062     Display.WahWah\_Sources[1] = POTI;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00063}00063     Display.WahWah\_Sources[2] = POTI;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00064}00064     Display.WahWah\_Sources[3] = POTI;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00066}00066     strcpy(Display.value\_str\_wahwah[0], \textcolor{stringliteral}{"{}OFF"{}});}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00068}00068     \mbox{\hyperlink{filters_8h_a30d8b183489ac4208a5fe11ba3a5dd40}{SetupBandpassCPG}}(WahWah-\/>bandpass, WahWah-\/>mid\_freq, WahWah-\/>bandpass-\/>Q);}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00070}00070     \textcolor{keywordflow}{return} WAHWAH\_OK;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00071}00071 \}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00072}00072 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00078}\mbox{\hyperlink{wahwah_8h_a2fa3b9f5777f0876da0b828ee333673a}{00078}} WahWah\_Status \mbox{\hyperlink{wahwah_8h_a2fa3b9f5777f0876da0b828ee333673a}{ProcessWahWah}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structWahWah__t}{WahWah\_t}} *WahWah, \textcolor{keywordtype}{float} *data)\{}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00080}00080     \textcolor{comment}{// SET: mid frequency to at least 50 Hz due to filter response}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00081}00081     \textcolor{keywordflow}{if}(WahWah-\/>mid\_freq < 50)}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00082}00082         WahWah-\/>mid\_freq = 50;  \textcolor{comment}{// 50 Hz Offset;}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00084}00084     \textcolor{comment}{// RESET: Filter after 100 samples (with SR = 24k Hz >> 240 times a second)}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00085}00085     \textcolor{keywordflow}{if}(WahWah-\/>reinit\_counter == 100)\{}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00086}00086 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00087}00087         \mbox{\hyperlink{filters_8h_a30d8b183489ac4208a5fe11ba3a5dd40}{SetupBandpassCPG}}(WahWah-\/>bandpass, WahWah-\/>mid\_freq, WahWah-\/>bandpass-\/>Q);}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00088}00088         WahWah-\/>reinit\_counter = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00089}00089     \}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00091}00091     WahWah-\/>reinit\_counter++;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00093}00093     \mbox{\hyperlink{filters_8h_ad95e18a35a0ebacf27bc67222a71e275}{ProcessFilter}}(WahWah-\/>bandpass, data);}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00095}00095     \textcolor{keywordflow}{return} WAHWAH\_OK;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00096}00096 \}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00097}00097 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00105}\mbox{\hyperlink{wahwah_8h_a85d3b2ed1cf4a3aef7b32c97b2e64237}{00105}} WahWah\_Status \mbox{\hyperlink{wahwah_8h_a85d3b2ed1cf4a3aef7b32c97b2e64237}{ProcessAutoWahWah}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structWahWah__t}{WahWah\_t}} *WahWah, \textcolor{keywordtype}{float} *data)\{}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00107}00107     \textcolor{comment}{// mid\_freq and range have to be set in the display function}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00108}00108 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00109}00109     \textcolor{comment}{// FETCH: actual LFO value}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00110}00110     \mbox{\hyperlink{signal__synthesis_8h_a381bb27bca64ed7f5df822a3db09707a}{LFO\_SingleValueProcess}}(WahWah-\/>lfo, WAHWAH\_LFO);}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00112}00112     \textcolor{keywordflow}{if}(WahWah-\/>mid\_freq < 50)}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00113}00113         WahWah-\/>mid\_freq = 50;  \textcolor{comment}{// 50 Hz Offset;}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00114}00114 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00115}00115     WahWah-\/>mid\_freq\_mod = WahWah-\/>mid\_freq + (WahWah-\/>range / 2) * WahWah-\/>lfo-\/>lfo\_data;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00116}00116 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00117}00117     \textcolor{comment}{// RESET: Filter after 100 samples (with SR = 24k Hz >> 240 times a second)}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00118}00118     \textcolor{keywordflow}{if}(WahWah-\/>reinit\_counter == 100)\{}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00119}00119 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00120}00120         \mbox{\hyperlink{filters_8h_a30d8b183489ac4208a5fe11ba3a5dd40}{SetupBandpassCPG}}(WahWah-\/>bandpass, WahWah-\/>mid\_freq\_mod, WahWah-\/>bandpass-\/>Q);}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00121}00121         WahWah-\/>reinit\_counter = 0;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00122}00122     \}}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00124}00124     WahWah-\/>reinit\_counter++;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00126}00126     \mbox{\hyperlink{filters_8h_ad95e18a35a0ebacf27bc67222a71e275}{ProcessFilter}}(WahWah-\/>bandpass, data);}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00127}00127 }
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00128}00128     \textcolor{keywordflow}{return} WAHWAH\_OK;}
\DoxyCodeLine{\Hypertarget{wahwah_8c_source_l00129}00129 \}}

\end{DoxyCode}
