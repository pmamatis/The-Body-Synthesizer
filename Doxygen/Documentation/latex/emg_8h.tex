\hypertarget{emg_8h}{}\doxysection{/media/paul/\+LINUX\+\_\+\+MEM/\+Uni/\+Git Repos/\+Body-\/\+Synthesizer\+\_\+\+STM32\+\_\+\+F746\+ZG/body-\/synthesizer-\/stm32-\/f746zg/\+Core/\+Inc/emg.h File Reference}
\label{emg_8h}\index{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Inc/emg.h@{/media/paul/LINUX\_MEM/Uni/Git Repos/Body-\/Synthesizer\_STM32\_F746ZG/body-\/synthesizer-\/stm32-\/f746zg/Core/Inc/emg.h}}


emg and ecg  


{\ttfamily \#include \char`\"{}main.\+h\char`\"{}}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{emg_8h_aef2f74bc8f2632e5eb78c2aaa1222ece}{EMG\+\_\+\+READ\+\_\+\+LENGTH}}~20
\item 
\#define \mbox{\hyperlink{emg_8h_a0467216c3971f76f80c488c1d1b89c42}{EMG\+\_\+\+SR}}~5000
\item 
\#define \mbox{\hyperlink{emg_8h_ad4da5bbe0f76fdca7af3576d6d5eb417}{EMG\+\_\+\+MI}}~1
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
HAL\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{emg_8h_aa7d92b6a1983e52614915f8e2cfb3140}{emg\+\_\+init}} (ADC\+\_\+\+Handle\+Type\+Def $\ast$hadc, TIM\+\_\+\+Handle\+Type\+Def $\ast$htim)
\begin{DoxyCompactList}\small\item\em EMG Init. \end{DoxyCompactList}\item 
HAL\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{emg_8h_a98bf9a8015f7a7833276fbf6a72e255e}{ecg\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em ECG init. \end{DoxyCompactList}\item 
HAL\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{emg_8h_ad8539de6db12ec20b070f6fb97f99a73}{emg\+\_\+start\+\_\+read}} (void)
\begin{DoxyCompactList}\small\item\em start all necessary peripherals for the EMG/\+ECG \end{DoxyCompactList}\item 
HAL\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{emg_8h_a305d3a0240c6e197a771b26c8d4fd22a}{emg\+\_\+stop\+\_\+read}} (void)
\begin{DoxyCompactList}\small\item\em Only stops the ADC reading of the connected EMG/\+ECG board. \end{DoxyCompactList}\item 
HAL\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{emg_8h_a63f5337cb5d5feb55ddedd79bca265d9}{emg\+\_\+peak\+\_\+detection}} (void)
\begin{DoxyCompactList}\small\item\em detects an EMG peak and sets flags for further processing \end{DoxyCompactList}\item 
void \mbox{\hyperlink{emg_8h_a6ad14645e09a9e49124abbb14199027f}{ecg\+\_\+heartrate}} (void)
\begin{DoxyCompactList}\small\item\em detect heartrate and change the Drumcoputer BPM in realtime \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
ADC\+\_\+\+Handle\+Type\+Def $\ast$ \mbox{\hyperlink{emg_8h_aa0343f5f6ec51b2315e8af04936ded6c}{EMG\+\_\+\+ADC}}
\item 
TIM\+\_\+\+Handle\+Type\+Def $\ast$ \mbox{\hyperlink{emg_8h_aaaca668bcd874fee31cc4dbf110f241c}{EMG\+\_\+\+TIM}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_afbfbad3430f3ca07748fe46ea721f425}{emg\+\_\+buffer}} \mbox{[}EMG\+\_\+\+READ\+\_\+\+LENGTH\mbox{]}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_a820e056b9586fec05150a738d09828c7}{emg\+\_\+detection\+Threshold}}
\item 
uint8\+\_\+t \mbox{\hyperlink{emg_8h_abc598a894ad122f8758e1469ef82405b}{emg\+\_\+peak}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_aeefbcf6066e07f71f063f2374aaf5cf8}{emg\+\_\+toggle\+Counter}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_a72eccf432ccbca5a28d55952a2162149}{emg\+\_\+toggle\+Threshold}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_a5dbb1dd2634480627376d02417b18aa4}{emg\+\_\+max\+Detection\+Threshold}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_a8a1f1f967c2c635001bb4feb13db46a1}{emg\+\_\+max\+Toggle\+Threshold}}
\item 
bool \mbox{\hyperlink{emg_8h_adbcea8e6bb2a0b7d11f6dc8922cae7c5}{emg\+\_\+toggled}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_a7c8f024fed67aaecdb0696b8c7ef88c0}{ecg\+\_\+meas\+Int}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_abde05bcf6583c365191e87886cca6a6a}{ecg\+\_\+detection\+Threshold}}
\item 
uint8\+\_\+t \mbox{\hyperlink{emg_8h_a739bff2109fffa5194f6d9eec65a2ae3}{ecg\+\_\+peaks}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_abfde41aeb1a8bd2fba440438c488013d}{ecg\+\_\+toggle\+Counter}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_adf508018b5bffa0045774b49aaadbea6}{ecg\+\_\+toggle\+Threshold}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_adb1057f6f992deabcf704e9715ee089a}{ecg\+\_\+max\+Detection\+Threshold}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_acc929fb59a231e854009488bd9cf0868}{ecg\+\_\+max\+Toggle\+Threshold}}
\item 
uint32\+\_\+t \mbox{\hyperlink{emg_8h_ab459858f605f9c5509b2ecce7294d5e4}{ecg\+\_\+int\+Count}}
\item 
bool \mbox{\hyperlink{emg_8h_af8252f523485fdd4b73185728fb467ab}{ecg\+\_\+peak}}
\item 
bool \mbox{\hyperlink{emg_8h_a5029188c23694b9770491106b607bc2c}{ecg\+\_\+toggled}}
\item 
float \mbox{\hyperlink{emg_8h_a9932f29af2ffe1856d0d0e29610efcac}{heartrate}}
\item 
uint8\+\_\+t \mbox{\hyperlink{emg_8h_acf0ee8035c8dba31c94430e6648c4704}{input\+Buffer\+\_\+position}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
emg and ecg 

\begin{DoxyAuthor}{Author}
paul mamatis 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2022-\/01-\/06
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2022 
\end{DoxyCopyright}


Definition in file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.



\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{emg_8h_ad4da5bbe0f76fdca7af3576d6d5eb417}\label{emg_8h_ad4da5bbe0f76fdca7af3576d6d5eb417}} 
\index{emg.h@{emg.h}!EMG\_MI@{EMG\_MI}}
\index{EMG\_MI@{EMG\_MI}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{EMG\_MI}{EMG\_MI}}
{\footnotesize\ttfamily \#define EMG\+\_\+\+MI~1}



Definition at line \mbox{\hyperlink{emg_8h_source_l00021}{21}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_aef2f74bc8f2632e5eb78c2aaa1222ece}\label{emg_8h_aef2f74bc8f2632e5eb78c2aaa1222ece}} 
\index{emg.h@{emg.h}!EMG\_READ\_LENGTH@{EMG\_READ\_LENGTH}}
\index{EMG\_READ\_LENGTH@{EMG\_READ\_LENGTH}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{EMG\_READ\_LENGTH}{EMG\_READ\_LENGTH}}
{\footnotesize\ttfamily \#define EMG\+\_\+\+READ\+\_\+\+LENGTH~20}



Definition at line \mbox{\hyperlink{emg_8h_source_l00019}{19}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a0467216c3971f76f80c488c1d1b89c42}\label{emg_8h_a0467216c3971f76f80c488c1d1b89c42}} 
\index{emg.h@{emg.h}!EMG\_SR@{EMG\_SR}}
\index{EMG\_SR@{EMG\_SR}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{EMG\_SR}{EMG\_SR}}
{\footnotesize\ttfamily \#define EMG\+\_\+\+SR~5000}



Definition at line \mbox{\hyperlink{emg_8h_source_l00020}{20}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{emg_8h_a6ad14645e09a9e49124abbb14199027f}\label{emg_8h_a6ad14645e09a9e49124abbb14199027f}} 
\index{emg.h@{emg.h}!ecg\_heartrate@{ecg\_heartrate}}
\index{ecg\_heartrate@{ecg\_heartrate}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_heartrate()}{ecg\_heartrate()}}
{\footnotesize\ttfamily void ecg\+\_\+heartrate (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



detect heartrate and change the Drumcoputer BPM in realtime 



Definition at line \mbox{\hyperlink{emg_8c_source_l00103}{103}} of file \mbox{\hyperlink{emg_8c_source}{emg.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00103                         \{}
\DoxyCodeLine{00104 }
\DoxyCodeLine{00105     uint16\_t ADC\_BLOCKSIZE\_startIndex=0, ADC\_BLOCKSIZE\_endIndex=0;}
\DoxyCodeLine{00106 }
\DoxyCodeLine{00107     \textcolor{comment}{//detect buffer half}}
\DoxyCodeLine{00108     \textcolor{keywordflow}{if}(inputBuffer\_position == HALF\_BLOCK) \{}
\DoxyCodeLine{00109         ADC\_BLOCKSIZE\_startIndex = 0;}
\DoxyCodeLine{00110         ADC\_BLOCKSIZE\_endIndex = EMG\_READ\_LENGTH/2;}
\DoxyCodeLine{00111     \}}
\DoxyCodeLine{00112     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(inputBuffer\_position == FULL\_BLOCK) \{}
\DoxyCodeLine{00113         ADC\_BLOCKSIZE\_startIndex = EMG\_READ\_LENGTH/2;}
\DoxyCodeLine{00114         ADC\_BLOCKSIZE\_endIndex = EMG\_READ\_LENGTH;}
\DoxyCodeLine{00115     \}}
\DoxyCodeLine{00116 }
\DoxyCodeLine{00117     \textcolor{comment}{//detect ECG peak}}
\DoxyCodeLine{00118     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = ADC\_BLOCKSIZE\_startIndex; i < ADC\_BLOCKSIZE\_endIndex; i+=2)\{}
\DoxyCodeLine{00119         \textcolor{keywordflow}{if}(emg\_buffer[i] > ecg\_detectionThreshold \&\& ecg\_toggleCounter > ecg\_toggleThreshold)\{}
\DoxyCodeLine{00120             ecg\_peaks += 1;}
\DoxyCodeLine{00121             HAL\_GPIO\_WritePin(Blue\_User\_LED\_GPIO\_Port, Blue\_User\_LED\_Pin,SET);}
\DoxyCodeLine{00122             ecg\_toggleCounter = 0;}
\DoxyCodeLine{00123             ecg\_peak = 1;}
\DoxyCodeLine{00124         \}}
\DoxyCodeLine{00125 }
\DoxyCodeLine{00126         \textcolor{keywordflow}{if}(ecg\_peak)\{}
\DoxyCodeLine{00127             ecg\_peak = 0;}
\DoxyCodeLine{00128             ecg\_toggled = 1;}
\DoxyCodeLine{00129 }
\DoxyCodeLine{00130         \}}
\DoxyCodeLine{00131         \textcolor{comment}{//delay to avoid false peaks rigth after another peak}}
\DoxyCodeLine{00132         \textcolor{keywordflow}{if}(ecg\_toggleCounter > ecg\_toggleThreshold \&\& ecg\_toggled == 1)\{}
\DoxyCodeLine{00133             ecg\_toggled = 0;}
\DoxyCodeLine{00134         \}}
\DoxyCodeLine{00135 }
\DoxyCodeLine{00136         \textcolor{comment}{//calculate heartrate when finishing a measurement Interval}}
\DoxyCodeLine{00137         \textcolor{keywordflow}{if} (ecg\_intCount == ecg\_measInt)\{}
\DoxyCodeLine{00138             heartrate = ((float)(60/(EMG\_MI))*ecg\_peaks)/2;}
\DoxyCodeLine{00139             ecg\_peaks = 0;}
\DoxyCodeLine{00140             ecg\_intCount = 0;}
\DoxyCodeLine{00141 }
\DoxyCodeLine{00142             \textcolor{comment}{//direct transfer of the heartrate to Drumcomputer}}
\DoxyCodeLine{00143             \textcolor{keywordflow}{if}(Display.Drumcomputer\_BPMbyECG\_ONOFF == \textcolor{keyword}{true}) \{}
\DoxyCodeLine{00144 }
\DoxyCodeLine{00145                 \mbox{\hyperlink{drum__computer_8h_a0065e192c774e20fd5e0ab3c342b7088}{BPM}} = heartrate;}
\DoxyCodeLine{00146             \}}
\DoxyCodeLine{00147         \}}
\DoxyCodeLine{00148 }
\DoxyCodeLine{00149         \textcolor{comment}{//update drumcoputer-\/page and reset values drumcoputer when bpm changed, to avoid "{}plop"{}-\/noise}}
\DoxyCodeLine{00150         \textcolor{keywordflow}{if}(abs(last\_BPM-\/\mbox{\hyperlink{drum__computer_8h_a0065e192c774e20fd5e0ab3c342b7088}{BPM}}) > 3) \{}
\DoxyCodeLine{00151 }
\DoxyCodeLine{00152             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0; i<\mbox{\hyperlink{drum__computer_8h_a267b06d60a7514d898b5cac91b4380ec}{FourFour}}; i++) \{}
\DoxyCodeLine{00153 }
\DoxyCodeLine{00154                 \textcolor{comment}{// INIT: Counter}}
\DoxyCodeLine{00155                 counter\_DS1[i] = 0;}
\DoxyCodeLine{00156                 counter\_DS2[i] = 0;}
\DoxyCodeLine{00157                 counter\_DS3[i] = 0;}
\DoxyCodeLine{00158                 counter\_DS4[i] = 0;}
\DoxyCodeLine{00159 }
\DoxyCodeLine{00160                 \mbox{\hyperlink{drum__computer_8h_ad32e19a8282780d0a134ec07797ac10b}{drum\_index}} = 0;}
\DoxyCodeLine{00161                 \mbox{\hyperlink{drum__computer_8h_a148d70203e23260f999890046d5509b0}{counter\_master}} = 0;}
\DoxyCodeLine{00162 }
\DoxyCodeLine{00163                 \textcolor{comment}{// RESET: Drum sound bins}}
\DoxyCodeLine{00164                 \mbox{\hyperlink{drum__computer_8h_a1d0ce949a258b04a5822d3442fd73d83}{DS1s}} = 0;}
\DoxyCodeLine{00165                 DS2s = 0;}
\DoxyCodeLine{00166                 DS3s = 0;}
\DoxyCodeLine{00167                 DS4s = 0;}
\DoxyCodeLine{00168 }
\DoxyCodeLine{00169                 drums = 0;}
\DoxyCodeLine{00170 }
\DoxyCodeLine{00171                 timing\_position\_in\_samples[i] = (\mbox{\hyperlink{drum__computer_8h_a267b06d60a7514d898b5cac91b4380ec}{FourFour}} / 4 ) * (i + 1) * (MasterClock / \mbox{\hyperlink{drum__computer_8h_a267b06d60a7514d898b5cac91b4380ec}{FourFour}}) * (60 / \mbox{\hyperlink{drum__computer_8h_a0065e192c774e20fd5e0ab3c342b7088}{BPM}});}
\DoxyCodeLine{00172             \}}
\DoxyCodeLine{00173 }
\DoxyCodeLine{00174             sprintf(Display.value\_str\_drumcomputer[8], \textcolor{stringliteral}{"{}\%.f"{}}, \mbox{\hyperlink{drum__computer_8h_a0065e192c774e20fd5e0ab3c342b7088}{BPM}});}
\DoxyCodeLine{00175 }
\DoxyCodeLine{00176             \textcolor{comment}{// ACHTUNG ACHTUNG, SEITENZAHL USW. BEACHTEN!!!}}
\DoxyCodeLine{00177             \textcolor{comment}{// BPM set by ECG and display only updated with new BPM value on drumcomputer settings page}}
\DoxyCodeLine{00178             \textcolor{keywordflow}{if}(Display.pagePosition == 3 \&\& Display.currentDrumcomputer > 0) \{}
\DoxyCodeLine{00179                 Paint\_DrawFilledRectangle(\&paint, Display.value\_start\_x\_position-\/50, CASE2, Display.value\_end\_x\_position, CASE2+VALUE\_ROW\_LENGTH, UNCOLORED);}
\DoxyCodeLine{00180                 Paint\_DrawStringAt(\&paint, Display.value\_start\_x\_position-\/50, CASE2, Display.value\_str\_drumcomputer[8], \&Font12, COLORED);}
\DoxyCodeLine{00181             \}}
\DoxyCodeLine{00182 }
\DoxyCodeLine{00183             Display.UpdateDisplay = \textcolor{keyword}{true};}
\DoxyCodeLine{00184             last\_BPM = \mbox{\hyperlink{drum__computer_8h_a0065e192c774e20fd5e0ab3c342b7088}{BPM}};}
\DoxyCodeLine{00185         \}}
\DoxyCodeLine{00186 }
\DoxyCodeLine{00187         ecg\_toggleCounter++;}
\DoxyCodeLine{00188         ecg\_intCount++;}
\DoxyCodeLine{00189     \}}
\DoxyCodeLine{00190 \}}

\end{DoxyCode}
\mbox{\Hypertarget{emg_8h_a98bf9a8015f7a7833276fbf6a72e255e}\label{emg_8h_a98bf9a8015f7a7833276fbf6a72e255e}} 
\index{emg.h@{emg.h}!ecg\_init@{ecg\_init}}
\index{ecg\_init@{ecg\_init}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_init()}{ecg\_init()}}
{\footnotesize\ttfamily HAL\+\_\+\+Status\+Type\+Def ecg\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



ECG init. 

\begin{DoxyNote}{Note}
need to be called after \mbox{\hyperlink{emg_8h_aa7d92b6a1983e52614915f8e2cfb3140}{emg\+\_\+init()}} 
\end{DoxyNote}


Definition at line \mbox{\hyperlink{emg_8c_source_l00029}{29}} of file \mbox{\hyperlink{emg_8c_source}{emg.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00029                                 \{}
\DoxyCodeLine{00030 }
\DoxyCodeLine{00031     heartrate = 0;}
\DoxyCodeLine{00032 }
\DoxyCodeLine{00033     ecg\_detectionThreshold = 2500;}
\DoxyCodeLine{00034     ecg\_peaks = 0;}
\DoxyCodeLine{00035     ecg\_toggled = \textcolor{keyword}{false};}
\DoxyCodeLine{00036     ecg\_peak = \textcolor{keyword}{false};}
\DoxyCodeLine{00037     ecg\_toggleThreshold = EMG\_SR/10;}
\DoxyCodeLine{00038     ecg\_toggleCounter = ecg\_toggleThreshold;}
\DoxyCodeLine{00039     ecg\_measInt = EMG\_SR * EMG\_MI;}
\DoxyCodeLine{00040     ecg\_intCount = 0;}
\DoxyCodeLine{00041     ecg\_maxDetectionThreshold = 2850;}
\DoxyCodeLine{00042     ecg\_maxToggleThreshold = EMG\_SR/5;}
\DoxyCodeLine{00043 }
\DoxyCodeLine{00044     \textcolor{keywordflow}{return} HAL\_OK;}
\DoxyCodeLine{00045 \}}

\end{DoxyCode}
\mbox{\Hypertarget{emg_8h_aa7d92b6a1983e52614915f8e2cfb3140}\label{emg_8h_aa7d92b6a1983e52614915f8e2cfb3140}} 
\index{emg.h@{emg.h}!emg\_init@{emg\_init}}
\index{emg\_init@{emg\_init}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_init()}{emg\_init()}}
{\footnotesize\ttfamily HAL\+\_\+\+Status\+Type\+Def emg\+\_\+init (\begin{DoxyParamCaption}\item[{ADC\+\_\+\+Handle\+Type\+Def $\ast$}]{hadc,  }\item[{TIM\+\_\+\+Handle\+Type\+Def $\ast$}]{htim }\end{DoxyParamCaption})}



EMG Init. 



Definition at line \mbox{\hyperlink{emg_8c_source_l00011}{11}} of file \mbox{\hyperlink{emg_8c_source}{emg.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00011                                                                             \{}
\DoxyCodeLine{00012 }
\DoxyCodeLine{00013     EMG\_ADC = hadc;}
\DoxyCodeLine{00014     EMG\_TIM = htim;}
\DoxyCodeLine{00015     emg\_detectionThreshold = 2500;}
\DoxyCodeLine{00016     emg\_peak = 0;}
\DoxyCodeLine{00017     emg\_toggleThreshold = 50;}
\DoxyCodeLine{00018     emg\_toggleCounter = emg\_toggleThreshold;}
\DoxyCodeLine{00019     emg\_toggled = 0;}
\DoxyCodeLine{00020     emg\_maxDetectionThreshold = 2850;}
\DoxyCodeLine{00021     emg\_maxToggleThreshold = EMG\_SR/5;}
\DoxyCodeLine{00022 }
\DoxyCodeLine{00023     \textcolor{keywordflow}{return} HAL\_OK;}
\DoxyCodeLine{00024 \}}

\end{DoxyCode}
\mbox{\Hypertarget{emg_8h_a63f5337cb5d5feb55ddedd79bca265d9}\label{emg_8h_a63f5337cb5d5feb55ddedd79bca265d9}} 
\index{emg.h@{emg.h}!emg\_peak\_detection@{emg\_peak\_detection}}
\index{emg\_peak\_detection@{emg\_peak\_detection}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_peak\_detection()}{emg\_peak\_detection()}}
{\footnotesize\ttfamily HAL\+\_\+\+Status\+Type\+Def emg\+\_\+peak\+\_\+detection (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



detects an EMG peak and sets flags for further processing 

\begin{DoxyNote}{Note}
needs to be called in an ADC interrupt 
\end{DoxyNote}


Definition at line \mbox{\hyperlink{emg_8c_source_l00062}{62}} of file \mbox{\hyperlink{emg_8c_source}{emg.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00062                                           \{}
\DoxyCodeLine{00063 }
\DoxyCodeLine{00064     uint16\_t ADC\_BLOCKSIZE\_startIndex=0, ADC\_BLOCKSIZE\_endIndex=0;}
\DoxyCodeLine{00065 }
\DoxyCodeLine{00066     \textcolor{comment}{//decide which buffer half}}
\DoxyCodeLine{00067     \textcolor{keywordflow}{if}(inputBuffer\_position == HALF\_BLOCK) \{}
\DoxyCodeLine{00068         ADC\_BLOCKSIZE\_startIndex = 0;}
\DoxyCodeLine{00069         ADC\_BLOCKSIZE\_endIndex = EMG\_READ\_LENGTH/2;}
\DoxyCodeLine{00070     \}}
\DoxyCodeLine{00071     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(inputBuffer\_position == FULL\_BLOCK) \{}
\DoxyCodeLine{00072         ADC\_BLOCKSIZE\_startIndex = EMG\_READ\_LENGTH/2;}
\DoxyCodeLine{00073         ADC\_BLOCKSIZE\_endIndex = EMG\_READ\_LENGTH;}
\DoxyCodeLine{00074     \}}
\DoxyCodeLine{00075 }
\DoxyCodeLine{00076     \textcolor{comment}{//peak detection}}
\DoxyCodeLine{00077     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = ADC\_BLOCKSIZE\_startIndex; i < ADC\_BLOCKSIZE\_endIndex; i+=2)\{}
\DoxyCodeLine{00078         \textcolor{keywordflow}{if}(emg\_buffer[i] > emg\_detectionThreshold \&\& emg\_toggleCounter > emg\_toggleThreshold)\{}
\DoxyCodeLine{00079             emg\_peak = 1;}
\DoxyCodeLine{00080             emg\_toggleCounter = 0;}
\DoxyCodeLine{00081             HAL\_GPIO\_WritePin(Red\_User\_LED\_GPIO\_Port, Red\_User\_LED\_Pin,SET);}
\DoxyCodeLine{00082             emg\_toggled = 1;}
\DoxyCodeLine{00083         \}}
\DoxyCodeLine{00084         \textcolor{keywordflow}{if}(emg\_toggleCounter > emg\_toggleThreshold \&\& emg\_toggled == 1)\{}
\DoxyCodeLine{00085             HAL\_GPIO\_WritePin(Red\_User\_LED\_GPIO\_Port, Red\_User\_LED\_Pin,RESET);}
\DoxyCodeLine{00086             emg\_toggled = 0;}
\DoxyCodeLine{00087         \}}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089         emg\_toggleCounter++;}
\DoxyCodeLine{00090     \}}
\DoxyCodeLine{00091 }
\DoxyCodeLine{00092     \textcolor{comment}{//sample playing controlled by EMG}}
\DoxyCodeLine{00093     \textcolor{keywordflow}{if}(Display.PlaySingleSample\_ONOFF == \textcolor{keyword}{true} \&\& emg\_peak == 1) \{}
\DoxyCodeLine{00094 }
\DoxyCodeLine{00095         play\_single\_sample\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{00096         emg\_peak = 0;}
\DoxyCodeLine{00097     \}}
\DoxyCodeLine{00098 }
\DoxyCodeLine{00099     \textcolor{keywordflow}{return} HAL\_OK;}
\DoxyCodeLine{00100 \}}

\end{DoxyCode}
\mbox{\Hypertarget{emg_8h_ad8539de6db12ec20b070f6fb97f99a73}\label{emg_8h_ad8539de6db12ec20b070f6fb97f99a73}} 
\index{emg.h@{emg.h}!emg\_start\_read@{emg\_start\_read}}
\index{emg\_start\_read@{emg\_start\_read}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_start\_read()}{emg\_start\_read()}}
{\footnotesize\ttfamily HAL\+\_\+\+Status\+Type\+Def emg\+\_\+start\+\_\+read (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



start all necessary peripherals for the EMG/\+ECG 



Definition at line \mbox{\hyperlink{emg_8c_source_l00047}{47}} of file \mbox{\hyperlink{emg_8c_source}{emg.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00047                                       \{}
\DoxyCodeLine{00048 }
\DoxyCodeLine{00049     \mbox{\hyperlink{signal__synthesis_8h_adc7b4110b68d58532096fe9f817df89c}{SetTimerSettings}}(EMG\_TIM, EMG\_SR);}
\DoxyCodeLine{00050     HAL\_TIM\_Base\_Start(EMG\_TIM);}
\DoxyCodeLine{00051     printf(\textcolor{stringliteral}{"{}start emg\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{00052     \textcolor{keywordflow}{return} HAL\_ADC\_Start\_DMA(EMG\_ADC, emg\_buffer, EMG\_READ\_LENGTH);}
\DoxyCodeLine{00053 \}}

\end{DoxyCode}
\mbox{\Hypertarget{emg_8h_a305d3a0240c6e197a771b26c8d4fd22a}\label{emg_8h_a305d3a0240c6e197a771b26c8d4fd22a}} 
\index{emg.h@{emg.h}!emg\_stop\_read@{emg\_stop\_read}}
\index{emg\_stop\_read@{emg\_stop\_read}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_stop\_read()}{emg\_stop\_read()}}
{\footnotesize\ttfamily HAL\+\_\+\+Status\+Type\+Def emg\+\_\+stop\+\_\+read (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Only stops the ADC reading of the connected EMG/\+ECG board. 



Definition at line \mbox{\hyperlink{emg_8c_source_l00056}{56}} of file \mbox{\hyperlink{emg_8c_source}{emg.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00056                                      \{}
\DoxyCodeLine{00057     \textcolor{keywordflow}{return} HAL\_ADC\_Stop\_DMA(EMG\_ADC);}
\DoxyCodeLine{00058 \}}

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{emg_8h_abde05bcf6583c365191e87886cca6a6a}\label{emg_8h_abde05bcf6583c365191e87886cca6a6a}} 
\index{emg.h@{emg.h}!ecg\_detectionThreshold@{ecg\_detectionThreshold}}
\index{ecg\_detectionThreshold@{ecg\_detectionThreshold}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_detectionThreshold}{ecg\_detectionThreshold}}
{\footnotesize\ttfamily uint32\+\_\+t ecg\+\_\+detection\+Threshold}



Definition at line \mbox{\hyperlink{emg_8h_source_l00044}{44}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_ab459858f605f9c5509b2ecce7294d5e4}\label{emg_8h_ab459858f605f9c5509b2ecce7294d5e4}} 
\index{emg.h@{emg.h}!ecg\_intCount@{ecg\_intCount}}
\index{ecg\_intCount@{ecg\_intCount}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_intCount}{ecg\_intCount}}
{\footnotesize\ttfamily uint32\+\_\+t ecg\+\_\+int\+Count}



Definition at line \mbox{\hyperlink{emg_8h_source_l00050}{50}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_adb1057f6f992deabcf704e9715ee089a}\label{emg_8h_adb1057f6f992deabcf704e9715ee089a}} 
\index{emg.h@{emg.h}!ecg\_maxDetectionThreshold@{ecg\_maxDetectionThreshold}}
\index{ecg\_maxDetectionThreshold@{ecg\_maxDetectionThreshold}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_maxDetectionThreshold}{ecg\_maxDetectionThreshold}}
{\footnotesize\ttfamily uint32\+\_\+t ecg\+\_\+max\+Detection\+Threshold}



Definition at line \mbox{\hyperlink{emg_8h_source_l00048}{48}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_acc929fb59a231e854009488bd9cf0868}\label{emg_8h_acc929fb59a231e854009488bd9cf0868}} 
\index{emg.h@{emg.h}!ecg\_maxToggleThreshold@{ecg\_maxToggleThreshold}}
\index{ecg\_maxToggleThreshold@{ecg\_maxToggleThreshold}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_maxToggleThreshold}{ecg\_maxToggleThreshold}}
{\footnotesize\ttfamily uint32\+\_\+t ecg\+\_\+max\+Toggle\+Threshold}



Definition at line \mbox{\hyperlink{emg_8h_source_l00049}{49}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a7c8f024fed67aaecdb0696b8c7ef88c0}\label{emg_8h_a7c8f024fed67aaecdb0696b8c7ef88c0}} 
\index{emg.h@{emg.h}!ecg\_measInt@{ecg\_measInt}}
\index{ecg\_measInt@{ecg\_measInt}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_measInt}{ecg\_measInt}}
{\footnotesize\ttfamily uint32\+\_\+t ecg\+\_\+meas\+Int}



Definition at line \mbox{\hyperlink{emg_8h_source_l00043}{43}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_af8252f523485fdd4b73185728fb467ab}\label{emg_8h_af8252f523485fdd4b73185728fb467ab}} 
\index{emg.h@{emg.h}!ecg\_peak@{ecg\_peak}}
\index{ecg\_peak@{ecg\_peak}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_peak}{ecg\_peak}}
{\footnotesize\ttfamily bool ecg\+\_\+peak}



Definition at line \mbox{\hyperlink{emg_8h_source_l00051}{51}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a739bff2109fffa5194f6d9eec65a2ae3}\label{emg_8h_a739bff2109fffa5194f6d9eec65a2ae3}} 
\index{emg.h@{emg.h}!ecg\_peaks@{ecg\_peaks}}
\index{ecg\_peaks@{ecg\_peaks}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_peaks}{ecg\_peaks}}
{\footnotesize\ttfamily uint8\+\_\+t ecg\+\_\+peaks}



Definition at line \mbox{\hyperlink{emg_8h_source_l00045}{45}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_abfde41aeb1a8bd2fba440438c488013d}\label{emg_8h_abfde41aeb1a8bd2fba440438c488013d}} 
\index{emg.h@{emg.h}!ecg\_toggleCounter@{ecg\_toggleCounter}}
\index{ecg\_toggleCounter@{ecg\_toggleCounter}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_toggleCounter}{ecg\_toggleCounter}}
{\footnotesize\ttfamily uint32\+\_\+t ecg\+\_\+toggle\+Counter}



Definition at line \mbox{\hyperlink{emg_8h_source_l00046}{46}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a5029188c23694b9770491106b607bc2c}\label{emg_8h_a5029188c23694b9770491106b607bc2c}} 
\index{emg.h@{emg.h}!ecg\_toggled@{ecg\_toggled}}
\index{ecg\_toggled@{ecg\_toggled}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_toggled}{ecg\_toggled}}
{\footnotesize\ttfamily bool ecg\+\_\+toggled}



Definition at line \mbox{\hyperlink{emg_8h_source_l00052}{52}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_adf508018b5bffa0045774b49aaadbea6}\label{emg_8h_adf508018b5bffa0045774b49aaadbea6}} 
\index{emg.h@{emg.h}!ecg\_toggleThreshold@{ecg\_toggleThreshold}}
\index{ecg\_toggleThreshold@{ecg\_toggleThreshold}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{ecg\_toggleThreshold}{ecg\_toggleThreshold}}
{\footnotesize\ttfamily uint32\+\_\+t ecg\+\_\+toggle\+Threshold}



Definition at line \mbox{\hyperlink{emg_8h_source_l00047}{47}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_aa0343f5f6ec51b2315e8af04936ded6c}\label{emg_8h_aa0343f5f6ec51b2315e8af04936ded6c}} 
\index{emg.h@{emg.h}!EMG\_ADC@{EMG\_ADC}}
\index{EMG\_ADC@{EMG\_ADC}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{EMG\_ADC}{EMG\_ADC}}
{\footnotesize\ttfamily ADC\+\_\+\+Handle\+Type\+Def$\ast$ EMG\+\_\+\+ADC}



Definition at line \mbox{\hyperlink{emg_8h_source_l00027}{27}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_afbfbad3430f3ca07748fe46ea721f425}\label{emg_8h_afbfbad3430f3ca07748fe46ea721f425}} 
\index{emg.h@{emg.h}!emg\_buffer@{emg\_buffer}}
\index{emg\_buffer@{emg\_buffer}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_buffer}{emg\_buffer}}
{\footnotesize\ttfamily uint32\+\_\+t emg\+\_\+buffer\mbox{[}EMG\+\_\+\+READ\+\_\+\+LENGTH\mbox{]}}



Definition at line \mbox{\hyperlink{emg_8h_source_l00031}{31}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a820e056b9586fec05150a738d09828c7}\label{emg_8h_a820e056b9586fec05150a738d09828c7}} 
\index{emg.h@{emg.h}!emg\_detectionThreshold@{emg\_detectionThreshold}}
\index{emg\_detectionThreshold@{emg\_detectionThreshold}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_detectionThreshold}{emg\_detectionThreshold}}
{\footnotesize\ttfamily uint32\+\_\+t emg\+\_\+detection\+Threshold}



Definition at line \mbox{\hyperlink{emg_8h_source_l00034}{34}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a5dbb1dd2634480627376d02417b18aa4}\label{emg_8h_a5dbb1dd2634480627376d02417b18aa4}} 
\index{emg.h@{emg.h}!emg\_maxDetectionThreshold@{emg\_maxDetectionThreshold}}
\index{emg\_maxDetectionThreshold@{emg\_maxDetectionThreshold}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_maxDetectionThreshold}{emg\_maxDetectionThreshold}}
{\footnotesize\ttfamily uint32\+\_\+t emg\+\_\+max\+Detection\+Threshold}



Definition at line \mbox{\hyperlink{emg_8h_source_l00038}{38}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a8a1f1f967c2c635001bb4feb13db46a1}\label{emg_8h_a8a1f1f967c2c635001bb4feb13db46a1}} 
\index{emg.h@{emg.h}!emg\_maxToggleThreshold@{emg\_maxToggleThreshold}}
\index{emg\_maxToggleThreshold@{emg\_maxToggleThreshold}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_maxToggleThreshold}{emg\_maxToggleThreshold}}
{\footnotesize\ttfamily uint32\+\_\+t emg\+\_\+max\+Toggle\+Threshold}



Definition at line \mbox{\hyperlink{emg_8h_source_l00039}{39}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_abc598a894ad122f8758e1469ef82405b}\label{emg_8h_abc598a894ad122f8758e1469ef82405b}} 
\index{emg.h@{emg.h}!emg\_peak@{emg\_peak}}
\index{emg\_peak@{emg\_peak}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_peak}{emg\_peak}}
{\footnotesize\ttfamily uint8\+\_\+t emg\+\_\+peak}



Definition at line \mbox{\hyperlink{emg_8h_source_l00035}{35}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_aaaca668bcd874fee31cc4dbf110f241c}\label{emg_8h_aaaca668bcd874fee31cc4dbf110f241c}} 
\index{emg.h@{emg.h}!EMG\_TIM@{EMG\_TIM}}
\index{EMG\_TIM@{EMG\_TIM}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{EMG\_TIM}{EMG\_TIM}}
{\footnotesize\ttfamily TIM\+\_\+\+Handle\+Type\+Def$\ast$ EMG\+\_\+\+TIM}



Definition at line \mbox{\hyperlink{emg_8h_source_l00028}{28}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_aeefbcf6066e07f71f063f2374aaf5cf8}\label{emg_8h_aeefbcf6066e07f71f063f2374aaf5cf8}} 
\index{emg.h@{emg.h}!emg\_toggleCounter@{emg\_toggleCounter}}
\index{emg\_toggleCounter@{emg\_toggleCounter}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_toggleCounter}{emg\_toggleCounter}}
{\footnotesize\ttfamily uint32\+\_\+t emg\+\_\+toggle\+Counter}



Definition at line \mbox{\hyperlink{emg_8h_source_l00036}{36}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_adbcea8e6bb2a0b7d11f6dc8922cae7c5}\label{emg_8h_adbcea8e6bb2a0b7d11f6dc8922cae7c5}} 
\index{emg.h@{emg.h}!emg\_toggled@{emg\_toggled}}
\index{emg\_toggled@{emg\_toggled}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_toggled}{emg\_toggled}}
{\footnotesize\ttfamily bool emg\+\_\+toggled}



Definition at line \mbox{\hyperlink{emg_8h_source_l00040}{40}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a72eccf432ccbca5a28d55952a2162149}\label{emg_8h_a72eccf432ccbca5a28d55952a2162149}} 
\index{emg.h@{emg.h}!emg\_toggleThreshold@{emg\_toggleThreshold}}
\index{emg\_toggleThreshold@{emg\_toggleThreshold}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{emg\_toggleThreshold}{emg\_toggleThreshold}}
{\footnotesize\ttfamily uint32\+\_\+t emg\+\_\+toggle\+Threshold}



Definition at line \mbox{\hyperlink{emg_8h_source_l00037}{37}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_a9932f29af2ffe1856d0d0e29610efcac}\label{emg_8h_a9932f29af2ffe1856d0d0e29610efcac}} 
\index{emg.h@{emg.h}!heartrate@{heartrate}}
\index{heartrate@{heartrate}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{heartrate}{heartrate}}
{\footnotesize\ttfamily float heartrate}



Definition at line \mbox{\hyperlink{emg_8h_source_l00053}{53}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

\mbox{\Hypertarget{emg_8h_acf0ee8035c8dba31c94430e6648c4704}\label{emg_8h_acf0ee8035c8dba31c94430e6648c4704}} 
\index{emg.h@{emg.h}!inputBuffer\_position@{inputBuffer\_position}}
\index{inputBuffer\_position@{inputBuffer\_position}!emg.h@{emg.h}}
\doxysubsubsection{\texorpdfstring{inputBuffer\_position}{inputBuffer\_position}}
{\footnotesize\ttfamily uint8\+\_\+t input\+Buffer\+\_\+position}



Definition at line \mbox{\hyperlink{emg_8h_source_l00055}{55}} of file \mbox{\hyperlink{emg_8h_source}{emg.\+h}}.

